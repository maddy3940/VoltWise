version: 2.1
jobs:
  deploy_lambda:
    docker:
      - image: circleci/python:3.9

    steps:
      - checkout

      # Install AWS CLI
      - run:
          name: Install AWS CLI
          command: sudo pip install awscli

      # Configure AWS CLI
      - run:
          name: Configure AWS CLI
          command: |
            mkdir -p ~/.aws
            echo "[default]" > ~/.aws/config
            echo "region = us-east-1" >> ~/.aws/config
            echo "[default]" > ~/.aws/credentials
            echo "aws_access_key_id = $AWS_ACCESS_KEY_ID" >> ~/.aws/credentials
            echo "aws_secret_access_key = $AWS_SECRET_ACCESS_KEY" >> ~/.aws/credentials

     # Package Lambda function
      - run:
          name: Package Lambda function
          command: |
            cd Lambda/daily-ingestion/
            zip function.zip lambda_function.py

      # Deploy Lambda function
      - run:
          name: Deploy Lambda function
          command: |
            aws lambda update-function-code --function-name daily-ingestion --zip-file fileb://Lambda/daily-ingestion/function.zip